##Magento自定义URL
[1. Magento1.x 自定义短路由](#magento1_short_url)
[2. Magento2.1 自定义url rewrite短路由](#Magento2.1_自定义url_rewrite短路由)

* * *

###<span id="#magento1_short_url">Magento1.x 自定义短路由</span>

**config.xml**
```xml
<rewrite>
    <fancy_url>
        <from><![CDATA[/custom\/custom\/(.*)/]]></from>
        <to><![CDATA[/custom/custom/index/]]></to>
        <complete>1</complete>
    </fancy_url>
</rewrite>
```
* * *
###<span id="Magento2.1 自定义url rewrite短路由">Magento2.1_自定义url_rewrite短路由</span>
**1. 通过`url_rewrite`表进行复写**
缺点：不能带参数
```php
namespace Modules\Recipe\Setup;

use Magento\Framework\Setup\InstallDataInterface;
use Magento\Framework\Setup\ModuleContextInterface;
use Magento\Framework\Setup\ModuleDataSetupInterface;
use Magento\UrlRewrite\Model\UrlRewrite;

class InstallData implements InstallDataInterface
{
    protected $urlRewrite;

    public static $fields = [
        'url_rewrite_id',
        'entity_type',
        'entity_id',
        'request_path',
        'target_path',
        'redirect_type',
        'store_id',
        'description',
        'is_autogenerated',
        'metadata'
    ];
    public static $table = 'url_rewrite';

    public function __construct(
        UrlRewrite $urlRewrite
    ){
        $this->urlRewrite = $urlRewrite;
    }

    public function install(
        ModuleDataSetupInterface $setup,
        ModuleContextInterface $context
    )
    {
        self::insertData($setup, $context);
    }

    public function insertData(
        ModuleDataSetupInterface $setup,
        ModuleContextInterface $context
    )
    {
        if (!$this->urlRewrite->getCollection()->getItemByColumnValue('request_path', 'oppskrifter')) {
            $fields  = self::$fields;
            $table   = self::$table;
            $columns = [];
            foreach ($fields as $field) {
                $columns[] = $field;
            }

            $items = [[[null, 'custom', 0, 'oppskrifter', 'recipe/index/index', 0, 1, null, 0, null]]];
            $i     = 0;
            foreach ($items as $data) {
                $setup->getConnection()->insertArray($setup->getTable($table), $columns, $data);
                $i++;
                echo 'Iteration: ' . $i . ', ';
            }
        }
    }
}
```

- - -
**2. 通过截获路由修改**
例如：通过访问 `/optical-center` 指向到真实的控制器 `/pimcore/index/index`
`etc/frontend/di.xml`
```xml
<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <type name="Magento\Framework\App\RouterList">
        <arguments>
            <argument name="routerList" xsi:type="array">
                <!-- iten name, 自定义唯一 -->
                <item name="pimcoreParamsRedirect" xsi:type="array">
                    <!-- 截获Router的类所在位置 -->
                    <item name="class" xsi:type="string">Tenf\Router\Controller\Router</item>
                    <item name="disable" xsi:type="boolean">false</item>
                    <item name="sortOrder" xsi:type="string">50</item>
                </item>
            </argument>
        </arguments>
    </type>
</config>
```

`Tenf/Router/Controller/Router.php`
```php
namespace Tenf/Router/Controller;

use Magento\Framework\App\ActionFactory;
use Magento\Framework\App\ActionInterface;
use Magento\Framework\App\RequestInterface;
use Magento\Framework\App\RouterInterface;

class Router implements RouterInterface
{
    protected $actionFactory;

    public function __construct(ActionFactory $actionFactory)
    {
        $this->actionFactory = $actionFactory;
    }

    /**
     * @param RequestInterface $request
     * @return ActionInterface
     */
    public function match(RequestInterface $request)
    {
        $path = trim($request->getPathInfo(), '/');

        $parts = explode('/', $path);

		// 如果路径的第一个值是optical-center
        if ($parts && $parts[0] === 'optical-center') {
            $request->setParams($parts);

			// 设置自定义控制器
            $request->setModuleName('cpimcore')
                ->setControllerName('index')
                ->setActionName('index');
            /** @var ActionInterface */
            return $this->actionFactory->create('Magento\Framework\App\Action\Forward');
        }

        return null;
    }
}
```

##Documents
[http://devdocs.magento.com/guides/v2.0/extension-dev-guide/routing.html](http://devdocs.magento.com/guides/v2.0/extension-dev-guide/routing.html)